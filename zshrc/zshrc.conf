# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:/usr/local/bin:$PATH

# ----------------------------- ZSHRC ----------------------------
# Custom LS_COLORS - gold/green theme
export LS_COLORS="di=38;5;65:ln=38;5;101:ex=38;5;130:fi=38;5;180"
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME=""


# ---------------------------- PROMPT ----------------------------
setopt PROMPT_SUBST # Enable command substitution im prompt
# Git branch function
git_branch() {
    branch=$(git symbolic-ref --short HEAD 2>/dev/null)
    if [ -n "$branch" ]; then
        echo " %F{107}($branch)%f"
    fi
}

# Focus mode toggle
FOCUS_MODE=0
focus() {
    if [ $FOCUS_MODE -eq 0 ]; then
        FOCUS_MODE=1
        echo "Focus mode: ON"
    else
        FOCUS_MODE=0
        echo "Focus mode: OFF"
    fi
}

# Dynamic prompt based on focus mode
set_prompt() {
    if [ $FOCUS_MODE -eq 1 ]; then
        # Minimal focus prompt - just directory and cursor
        PROMPT=$'%F{107}╭─ %1~%f\n%F{214}╰─❯%f '
    else
        # Full prompt with box
        PROMPT='%F{240}╭─%f %F{136}%D{%I:%M %p}%f %F{100}%n%f %F{107}%~%f%F{240}$(git_branch)%f
%F{240}╰─%f%F{214}❯%f '
    fi
}

# Hook to update prompt before each command
precmd() {
    set_prompt
}

# Initialize with full prompt
set_prompt



# ------------------------- SOME STUFF -----------------------
plugins=( 
    git
    dnf
    zsh-autosuggestions
    zsh-syntax-highlighting
)

source $ZSH/oh-my-zsh.sh

HISTFILE=~/.zsh_history
HISTSIZE=10000
SAVEHIST=10000
setopt appendhistory

# ------------------------ TMUX ------------------------------
# Auto-start tmux
if command -v tmux &> /dev/null && [ -z "$TMUX" ]; then
    tmux attach -t default || tmux new -s default
fi


# ------------------------ IDK -------------------------------
# check the dnf plugins commands here
# https://github.com/ohmyzsh/ohmyzsh/tree/master/plugins/dnf

# fastfetch. Will be disabled if above colorscript was chosen to install
#fastfetch -c $HOME/.config/fastfetch/config-compact.jsonc


# ------------------------ FZF ------------------------------
# Set-up FZF key bindings (CTRL R for fuzzy history finder)
source <(fzf --zsh)

# Preview files with bat
export FZF_CTRL_T_OPTS="--preview 'bat --color=always --line-range :500 {}'"

# Better colors
export FZF_DEFAULT_OPTS='
  --height 40% 
  --layout=reverse 
  --border
  --color=fg:#d0d0d0,bg:#121212,hl:#5f87af
  --color=fg+:#d0d0d0,bg+:#262626,hl+:#5fd7ff
  --color=info:#afaf87,prompt:#d7005f,pointer:#af5fff
'

# Interactive directory navigator using fzf
nav() {
  while true; do
    local selection=$(
      (echo ".. "; ls) | fzf \
        --height=100% \
        --preview-window='right:90%:wrap' \
        --preview "
          if [ -d {} ]; then
            tree -C {} | head -100
          elif file --mime-type {} | grep -qE 'image/'; then
            chafa --format=sixel --work=5 --size=80x60 {}
          elif file --mime-type {} | grep -qE 'video/'; then
            mediainfo {} 2>/dev/null || echo 'Video file'
          else
            bat --color=always --line-range :500 {} 2>/dev/null || cat {}
          fi
        " \
        --header="$(pwd) | Enter:open | Ctrl-o:quit" \
        --bind="ctrl-o:abort" \
        --expect=ctrl-o
    )
    
    local key=$(echo "$selection" | head -1)
    local item=$(echo "$selection" | tail -1)
    
    [[ -z "$item" ]] && break
    [[ "$key" == "ctrl-o" ]] && break
    
    item=$(echo "$item" | xargs)
    
    if [[ "$item" == ". ." ]]; then
      cd ..
    elif [[ -d "$item" ]]; then
      cd "$item"
    else
      local ext="${item##*.}"
      ext="${ext:l}"
      
      case "$ext" in
        mp4|mkv|avi|mov|webm|flv|wmv)
          mpv "$item" &>/dev/null &
          ;;
        jpg|jpeg|png|gif|bmp|webp|svg|ico)
          imv "$item" &>/dev/null &
          ;;
        pdf)
          zathura "$item" &>/dev/null &
          ;;
        c|cpp|cc|h|hpp|py|sh|bash|zsh|lua|conf|json|yaml|yml|toml|md|txt|rs|go|js|ts|jsx|tsx|html|css|scss|vim|nix|zig|java|rb|php|sql|xml|ini|cfg|makefile|cmake)
          nvim "$item"
          ;;
        *)
          if file --mime-type "$item" | grep -qE "text/|application/json|application/xml"; then
            nvim "$item"
          else
            xdg-open "$item" &>/dev/null &
          fi
          ;;
      esac
      break
    fi
  done
}

# ---------------------- DIRECTORIES -----------------------
# Set-up icons for files/directories in terminal using lsd
alias ls='lsd'
alias l='ls -l'
alias la='ls -a'
alias lla='ls -la'
alias lt='ls --tree'
alias zen='~/Work/Apps/zen/zen'
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.local/bin:$PATH"
export PATH="$HOME/.local/bin:$PATH"
